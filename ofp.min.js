ofp={version:"0.0.1"},d3.selection.prototype.size=function(){var e=0;return this.each(function(){++e}),e},ofp.Layer=function(e,n){function s(){i.layerType.idList.forEach(function(e){var n=t.svg.selectAll(e);n&&n.size()>0&&!n.classed(i.layerType.className)&&(console.log("Repairing className: "+i.layerType.className+" for "+n.size()+" elements with id "+e),n.classed(i.layerType.className,!0))})}this.name=e.name,this.layerType=e;var t=n,i=this;this.remove=function(){this.layer.remove(),this.layer=d3.selectAll(this.layerType.idList.join())},s(),this.layer=t.svg.selectAll("."+e.className),this.elements=this.layer.selectAll("polygon, line, path, text"),console.log("Initialized Layer: "+this.layerType.name+" with "+this.elements.size()+" elements.")},ofp.Layer.prototype={name:"",layerType:null,layer:null,hide:function(){this.layer.style("display","none")},show:function(){this.layer.style("display","")},size:function(){return this.layer.size()}},ofp.LayerType=function(e,n,s){this.name=e,this.className=n,this.idList=s},ofp.LayerType.prototype={name:"",className:"",idList:[]},ofp.LayerType.Space=new ofp.LayerType("Space","ofp-space",["#bgspa_space_area_b"]),ofp.LayerType.Column=new ofp.LayerType("Column","ofp-column",["#Column","#bgspa_column_area_b"]),ofp.LayerType.Construction=new ofp.LayerType("Construction","ofp-construction",["#Constructions","#Frames"]),ofp.LayerType.DimensionAnnotations=new ofp.LayerType("Dimension Annotations","ofp-annotations-dimensions",["#Dimension","#A-ANNO-DIMS"]),ofp.FloorPlan=function(e){function n(){return s.innerHTML}this.svg=d3.select(e).select("svg"),this.spaces=new ofp.Layer(ofp.LayerType.Space,this),this.columns=new ofp.Layer(ofp.LayerType.Column,this),this.constructions=new ofp.Layer(ofp.LayerType.Construction,this),this.dimensionAnnotations=new ofp.Layer(ofp.LayerType.DimensionAnnotations,this);var s=e;this.exportSVG=function(){var e=n(),s='<?xml version="1.0" encoding="iso-8859-1"?>\n<!DOCTYPE svg [ \n]>\n';return e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/^]/gm,""),e=e.replace(/!\[CDATA/gm,"<![CDATA"),e=e.replace(/baseprofile/gm,"baseProfile"),e=e.replace(/viewbox/gm,"viewBox"),e=e.replace(/preserveaspectratio/gm,"preserveAspectRatio"),e=e.replace(/patternunits/gm,"patternUnits"),s+e}},ofp.FloorPlan.prototype={svg:null,getViewBox:function(){var e,n,s;return e=this.svg[0][0],e&&e.viewBox&&e.viewBox.baseVal?s=e.viewBox.baseVal:(n=e.attributes.viewbox._nodeValue.split(" "),s={x:n[0],y:n[1],width:n[2],height:n[3]}),s.toString=function(){return"SVG ViewBox xMin:"+this.x+" yMin:"+this.y+" width:"+this.width+" height:"+this.height},console.log(""+s),s}};