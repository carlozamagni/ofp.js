ofp={version:"0.0.1"},d3.selection.prototype.size=function(){var e=0;return this.each(function(){++e}),e},ofp.Layer=function(e,s){function t(){n.layerType.idList.forEach(function(e){var s=i.svg.selectAll(e);s&&s.size()>0&&!s.classed(n.layerType.className)&&(console.log("Repairing className: "+n.layerType.className+" for "+s.size()+" elements with id "+e),s.classed(n.layerType.className,!0))})}this.name=e.name,this.layerType=e;var i=s,n=this;this.remove=function(){this.layer.remove(),this.layer=d3.selectAll(this.layerType.idList.join())},t(),this.layer=i.svg.selectAll("."+e.className),this.elements=this.layer.selectAll("polygon, line, path, text"),console.log("Initialized Layer: "+this.layerType.name+" with "+this.elements.size()+" elements.")},ofp.Layer.prototype={name:"",layerType:null,layer:null,hide:function(){this.layer.style("display","none")},show:function(){this.layer.style("display","")},size:function(){return this.layer.size()}},ofp.LayerType=function(e,s,t){this.name=e,this.className=s,this.idList=t},ofp.LayerType.prototype={name:"",className:"",idList:[]},ofp.LayerType.Space=new ofp.LayerType("Space","ofp-space",["#bgspa_space_area_b"]),ofp.LayerType.Column=new ofp.LayerType("Column","ofp-column",["#Column","#bgspa_column_area_b"]),ofp.LayerType.Construction=new ofp.LayerType("Construction","ofp-construction",["#Constructions","#Frames"]),ofp.LayerType.DimensionAnnotations=new ofp.LayerType("Dimension Annotations","ofp-annotations-dimensions",["#Dimension","#A-ANNO-DIMS"]),ofp.FloorPlan=function(e,s){"use strict";function t(){return n.innerHTML}if(this.svg=d3.select(e).select("svg"),s){var i;for(i in s)s.hasOwnProperty(i)&&(this[i]=s[i],this.layers.push(this[i]))}else this.spaces=new ofp.Layer(ofp.LayerType.Space,this),this.layers.push(this.spaces),this.columns=new ofp.Layer(ofp.LayerType.Column,this),this.layers.push(this.columns),this.constructions=new ofp.Layer(ofp.LayerType.Construction,this),this.layers.push(this.constructions),this.dimensionAnnotations=new ofp.Layer(ofp.LayerType.DimensionAnnotations,this),this.layers.push(this.dimensionAnnotations);var n=e;this.exportSVG=function(){var e=t(),s='<?xml version="1.0" encoding="iso-8859-1"?>\n<!DOCTYPE svg [ \n]>\n';return e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/^]/gm,""),e=e.replace(/!\[CDATA/gm,"<![CDATA"),e=e.replace(/baseprofile/gm,"baseProfile"),e=e.replace(/viewbox/gm,"viewBox"),e=e.replace(/preserveaspectratio/gm,"preserveAspectRatio"),e=e.replace(/patternunits/gm,"patternUnits"),s+e}},ofp.FloorPlan.prototype={svg:null,layers:[],getViewBox:function(){"use strict";var e,s,t;return e=this.svg[0][0],e&&e.viewBox&&e.viewBox.baseVal?t=e.viewBox.baseVal:(s=e.attributes.viewbox._nodeValue.split(" "),t={x:s[0],y:s[1],width:s[2],height:s[3]}),t.toString=function(){return"SVG ViewBox xMin:"+this.x+" yMin:"+this.y+" width:"+this.width+" height:"+this.height},console.log(""+t),t},getAvailableLayers:function(){"use strict";var e=[];return this.layers.forEach(function(s){s.size()>0&&e.push(s)}),e}};